package io.github.aasaru.drools.DrivingSession
import io.github.aasaru.drools.domain.DriveTimeExceeded;
import io.github.aasaru.drools.domain.Week;
import io.github.aasaru.drools.domain.InvalidWeek;

import io.github.aasaru.drools.domain.Drive;
import java.time.LocalDate;

rule "Exceed max driving time"
	dialect "java"
	when
		$week: Week( )
		$drive: Drive(drivingTime>540, drivingTime<=600)


	then
		System.out.println("Added drive time exceeded to drive  " +  $drive );
        modify($week){
        countDrivingTimeExceeded++;}

        System.out.println("CountExceeded= " + $week.countDrivingTimeExceeded);
end

rule "Max drive Exceeded a week "

    dialect "java"
    when
        $week: Week(countDrivingTimeExceeded>2)
        not(InvalidWeek(this.getWeek() == $week))
    then
        System.out.println("Invalid week");

        insert(new InvalidWeek($week));

end

rule "Invalid Drive More than 10 hours"

    dialect "java"
    when
        $drive: Drive(drivingTime>600)
        $week: Week(driveList.contains($drive))
        not(InvalidWeek(this.getWeek() == $week))


    then
         System.out.println("Invalid week, more than 10 hours");
         System.out.println("Dopo le 10 ore" + $week.countDrivingTimeExceeded);
         insert(new InvalidWeek($week));

end

rule "Max weekly Driving time"
    dialect "java"
    when
        $week: Week(this.weeklyDrivingTime()>3360)
        not(InvalidWeek(this.getWeek() == $week))

    then
        System.out.println("Invalid Week, because the weekly driving time exceeds the 56 hours");
        insert (new InvalidWeek($week));

end








